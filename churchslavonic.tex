\newfontfamily\russianfont[Script=Cyrillic,Ligatures=TeX]{Linux Libertine O}
\newfontfamily\russianfonttt[Ligatures=TeX]{lmmono10-regular.otf}
\newfontfamily\russianfontsf[Ligatures=TeX]{lmsans10-regular.otf}
\newfontfamily\churchslavonicfont[Script=Cyrillic,Ligatures=TeX,HyphenChar=_]{PonomarUnicode.otf}
\newfontfamily\musicFont[Scale=1.5]{MezenetsUnicode}

\usepackage{churchslavonic}
\usepackage{hyperref}
\usepackage{xltxtra}
\usepackage{doc}
\usepackage{lettrine}

\def\fileversion{0.3}
\let\cuKrukFont=\musicFont
\def\pkg#1{\textsf{#1}}
\def\cs#1{\texttt{\textbackslash #1}}
%
\cuDefineDateFormat{long}{%
  \cuDayName{\cuDOW},
  \cuNum{\cuDAY}\textunderscore гѡ~%
  \cuMonthName{\cuMONTH},~%
  лѣ́та ѿ сотворе́нїѧ мі́ра~\cuNum{\cuYEARAM}%
}
%
\makeatletter
\def\cu@lettrine{\lettrine[lines=3,findent=0pt,nindent=0pt]}
\def\cuLettrine{\cu@tokenizeletter\cu@lettrine}
\renewcommand{\LettrineFontHook}{\cuKinovarColor}
\makeatother

\begin{document}

\begin{EN}
\title{\pkg{churchslavonic} package --- Church Slavonic Typography in \LaTeX}
\author{Aleksandr Andreev and Mike Kroutikov\\version~\fileversion}
\end{EN}

\begin{RU}
\title{Пакет \pkg{churchslavonic} --- верстка церковнославянских текстов в системе \LaTeX}
\author{Александр Андреев и Михаил Крутиков\\версия~\fileversion}
\end{RU}

\date{\today}
\maketitle

\begin{EN}
\begin{abstract}
Package \pkg{churchslavonic} provides fonts, hyphenation patterns and supporting macros to typeset
Church Slavonic texts.
\end{abstract}
\end{EN}

\begin{RU}
\begin{abstract}
Пакет \pkg{churchslavonic} позволяет верстать церковнославянские документы. В пакет включены шаблоны переносов,
шрифты и набор необходимых макрокоманд.
\end{abstract}
\end{RU}

\tableofcontents

\begin{EN}
\section*{Introduction}
Church Slavonic (also called Church Slavic, Old Church Slavonic
or Old Slavonic; ISO 639-2 code \texttt{cu}) is a literary language used by
the Slavic peoples; presently it is used as a liturgical language by the
Russian Orthodox Church, other local Orthodox Churches, as well
as various Byzantine-Rite Catholic and Old Ritualist communities.
The package \texttt{churchslavonic} provides fonts, hyphenation
patterns and supporting macros to typeset
Church Slavonic texts in \TeX{}.

The package is designed to support Unicode text encoded in UTF-8.
Texts encoded in legacy codepages (such as HIP and UCS) may be
converted to Unicode using a separate bundle of utilities.
See the \href{http://sci.ponomar.net/}
{Slavonic Computing Initiative website} for more information.
To use the tools in this package, you will need a Unicode-aware \TeX{}
engine such as \XeTeX{} or \LuaTeX{}.
\end{EN}

\begin{RU}
\section*{Введение}
Церковнославянский язык (ISO 639-2 код \texttt{cu}) --
древний литературный язык славянских народов,
который теперь используется в основном как богослужебный язык
в Русской Православной Церкви, других поместных православных
церквях, а также в грекокатолических и старообрядческих общинах.
Пакет \pkg{churchslavonic} позволяет верстать церковнославянские тексты
в системе \TeX{}. В пакет включены шаблоны переносов,
шрифты и набор необходимых макрокоманд.

Данный пакет поддерживает только набор в стандарте Юникод.
Тексты, набранные в устаревших кодировках HIP и UCS,
можно конвертировать в Юникод (точнее -- в UTF-8) с помощью
отдельных утилит, которые можно найти на сайте
\href{http://sci.ponomar.net/}
{Инициативной группы славянской информатики}.
Для того, чтобы использовать возможности этого пакета Вам
понадобится система верстки \TeX{}, поддерживающая Юникод,
например, \XeTeX{} или \LuaTeX{}.
\end{RU}

\begin{EN}
\section{How to use the package}
To use the \pkg{churchslavonic} package one needs to include the following
declarations into the document preamble:
\end{EN}

\begin{RU}
\section{Как пользоваться пакетом}
Добавьте следующие определения в преамбулу вашего документа:
\end{RU}

\begin{verbatim}
\usepackage{polyglossia}
\setmainlanguage{churchslavonic}
\usepackage{churchslavonic}
\end{verbatim}

\begin{EN}
This makes the Church Slavonic hyphenation patterns immediately available.
After that, use the standard \pkg{polyglossia} commands to control current language.
Church Slavonic fonts are provided by the \pkg{fonts-churchslavonic} package,
which should have been installed automatically when you installed this package.
See the \pkg{fonts-churchslavonic} documentation for information about fonts.
\end{EN}

\begin{RU}
Сразу станут доступны церковнославянские шаблоны переноса слов.
После чего переключайтесь между языками стандартными средствами пакета \pkg{polyglossia}.
Церковнославянские шритфы предоставлены в отдельном пакете \pkg{fonts-churchslavonic},
который должен был установиться когда вы установили этот пакет.
Подробности о шрифтах смотрите в документации к пакету \pkg{fonts-churchslavonic}.
\end{RU}

\begin{EN}
\subsection{Options \texttt{color}, \texttt{gray} (= \texttt{grey}), and \texttt{bw}}
These options control what color is actually being used for text coloring commands like \cs{cuKinovar}.

\begin{itemize}
\item \texttt{color} this is the default option; it indicates the original color (a shade of red).
\item \texttt{gray} (\texttt{grey}) replaces the red color with gray - useful if you are printing on media that
    does not support color, but is capable of grayscale.
\item \texttt{bw} replaces the red color with black (effectively turning off
commands like \cs{cuKinovar} and \cs{cuKinovarColor}). Use
    this option to generate a document that will be printed in black-and-white.
\end{itemize}
Example:
\end{EN}

\begin{RU}
\subsection{Опции \texttt{color}, \texttt{gray} (= \texttt{grey}) и \texttt{bw}}
Опции позволяют отключать цвет раскраски текста в командах типа \cs{cuKinovar}.
Полезны для создания версий для печати на
устройствах, которые не поддерживают цветности.

\begin{itemize}
\item \texttt{color} эта опция используется по умолчанию и означает,
что используется нормальный красный цвет.
\item \texttt{gray} (\texttt{grey}) заменяет красный цвет серым --- используйте эту опцию если
ваше устройство печати не поддерживает цветности, но может качественно передавать градации серого цвета.
\item \texttt{bw} отключает всякую раскраску --- используйте для создания черно-белой версии документа.
\end{itemize}
Пример:
\end{RU}

\begin{verbatim}
\usepackage[gray]{churchslavonic}
\end{verbatim}

\begin{EN}
\subsection{Underscore}
The underscore symbol (\texttt{\textunderscore}, U+005F \textsc{Low Line})
 is a valid text symbol in Church Slavonic (it has roughly the same role
as the hyphen in English). The package \pkg{churchslavonic} redefines the
underscore in a way that it can be directly entered in text mode, for example:
\end{EN}
%
\begin{RU}
\subsection{Знак подчеркивания}
Знак подчеркивания (\texttt{\textunderscore}, U+005F \textsc{Low Line}))
в церковнославянском языке играет примерно ту же роль, что и дефис в русском.
Пакет \pkg{churchslavonic} переопределяет знак подчеркивания так, что его можно
набирать и в текстовой моде, например:
\end{RU}
%
\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
Послѣ́дованїе моле́бнагѡ пѣ́нїѧ ст҃ы̑мъ мч҃камъ к҃_гѡ вѣ́ка, \\
въ Са́нктъ_Петербꙋ́ржстѣй дꙋхо́внѣй а҆каде́мїи \\
нача̑льствовавшимъ, ᲂу҆чи̑вшимъ и҆ ᲂу҆чи̑вшимсѧ \\
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}
\cuKinovar{Attention:} if you have an older version of the \pkg{fontspec} package installed on your system,
the redefined underscore symbol cannot be used in font names and font options in \pkg{fontspec} commands like
\cs{setXXXfont} and \cs{newfontfamily}.

Typically you need to set underscore as the hyphenation character for Church Slavonic fonts: \texttt{HyphenChar=_}.
With older versions of \pkg{fontspec} this will cause errors. This problem exists in \TeX\ \texttt{Live 2013} and in \pkg{fontspec v2.3c}.

We recommend upgrading your \TeX\ distribution to at least \TeX\ \texttt{Live 2015}. Alternatively you can selectively
upgrade the \pkg{fontspec} package to version \texttt{v2.4c} or better.

If upgrading is not an option, you can work around this problem by either specifying the hexadecimal code for the hyphenation
character: \texttt{HyphenChar="005F}, or by declaring all fonts before loading \pkg{churchslavonic}.
\end{EN}

\begin{RU}
\cuKinovar{Внимание:} если у вас установлена старая версия пакета \pkg{fontspec},
переопределенный знак подчеркивания нельзя использовать при задании имен и параметров шрифтов в командах \pkg{fontspec} типа
\cs{setXXXfont} и \cs{newfontfamily}.

Обычно для церковнославянских шрифтов требуется установить подчеркивание как символ переноса, указав параметр:
\texttt{HyphenChar=_}. Старые версии \pkg{fontspec} выдадут ошибку.
Эта проблема присутствует в \TeX\ \texttt{Live 2013} и в \pkg{fontspec v2.3c}.

Мы рекомендуем обновить систему \TeX\ до \TeX\ \texttt{Live 2015} или свежее.
Или же обновить только пакет \pkg{fontspec} до
версии \texttt{2.4c} или более новой.

Если же вы не можете установить обновления, то можно
обойти проблему, указав символ переноса как код в шестнадцатиричном представлении:
\texttt{HyphenChar="005F}. Другой подход --- это декларировать все шрифты до загрузки пакета \pkg{churchslavonic}.
\end{RU}

\begin{EN}
\section{Numbers}

The Church Slavonic numbering system (Cyrillic numerals)
is based on Greek Ionian numerals and uses letters as digits.
For more information on the implementation, consult the appropriate section of \cite{UN41}.
\end{EN}

\begin{RU}
\section{Числа}
Способ записи чисел в церковнославянском языке (кириллическая цифирь)
основывается на древнегреческом и в
качестве цифр использует буквы.
За подробностями отсылаем интересующегося читателя к
соответствующей главе \cite{UN41}.
\end{RU}

\begin{EN}
\subsection{\cs{cuNum}}
Use this command to typeset a Cyrillic numeral.
The command takes a single argument that should expand to a number.
\end{EN}

\begin{RU}
\subsection{\cs{cuNum}}
Команда печатает число кириллической цифирью.
Она принимает единственный аргумент. Аргументом может быть текст или
командная последовательность. Единственное условие --- аргумент должен раскрыться в число.
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}{| l | l |}
\hline
\verb+\cuNum{1}+ & \cuNum{1} \\
\verb+\cuNum{12}+ & \cuNum{12} \\
\verb+\cuNum{123}+ & \cuNum{123} \\
\verb+\cuNum{1234}+ & \cuNum{1234} \\
\verb+\cuNum{10345}+ & \cuNum{10345} \\
\verb+\cuNum{12345}+ & \cuNum{12345} \\
\verb+\cuNum{123456}+ & \cuNum{123456} \\
\verb+\cuNum{800456}+ & \cuNum{800456} \\
\verb+\cuNum{1234567}+ & \cuNum{1234567} \\
\verb+\cuNum{1500567}+ & \cuNum{1500567} \\
\verb+\cuNum{12345678}+ & \cuNum{12345678} \\
\verb+\cuNum{123456789}+ & \cuNum{123456789} \\
\hline
\end{tabular}
\end{churchslavonic}
\end{center}


\begin{EN}
\section{Dates}
\end{EN}

\begin{RU}
\section{Даты}
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}[]{ | l | l | }
\hline
\verb+\cuDate{2016-4-21}+ & \cuDate{2016-4-21} \\
\verb+\cuDateJulian{2016-4-21}+ & \cuDateJulian{2016-4-21} \\
\verb+\cuDate{\cuToday}+ & \cuDate{\cuToday} \\
\hline
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}
\subsection{\cs{cuDate}}
This command formats the date (according to the current format).
The argument is a triplet of numbers \texttt{YYYY-MM-DD} specifying
the date. The output will be something like this: \textchurchslavonic{\cuDate{2016-04-22}}.

Note that \texttt{YYYY-MM-DD} values are not being normalized or interpreted in any way. Thus, it is totally fine to
call \verb+\cuDate{2016-4-32}+ even though April 32 is not a valid date. It will be formatted and printed as April 32. This
makes it possible to use this macro in a phrase like ``the date \verb+\cuDate{2016-4-32}+ is not a valid date in any calendar''.

However, if your date format uses \cs{cuDOW} (day of the week) or \cs{cuYEARAM} (year Anno Mundi), the later quantities are computed by
interpreting the date as a Gregorian calendar date. In this case, if the input date is not a valid date, it will be normalized via extrapolation.
For example, April 32 will be interpreted as May 2 for the purpose of determining values of the day of the week and year Anno Mundi.

If your format uses \cs{cuDOW} or \cs{cuYEARAM}, and you specify a date according to the Julian, not Gregorian, calendar, you must use \cs{cuDateJulian} to
correctly format days of the week and year Anno Mundi.

The best practice is to always use \cs{cuDate} with Gregorian calendar dates and use \cs{cuDateJulian} with Julian calendar dates regardless
of the current date format. This way you can switch the date formatting style without worrying about getting the wrong output.

\subsection{\cs{cuDateJulian}}
Formats the date, just like \cs{cuDate} does, but the argument is interpreted as a date on the Julian calendar (``old style'') instead of the Gregorian calendar.
This makes a difference only if your format is using symbolic names \cs{cuDOW} and/or \cs{cuYEARAM}.
\end{EN}

\begin{RU}

\subsection{\cs{cuDate}}
Команда форматирует дату (в соответствии с текущим форматом). Аргумент должен иметь вид \texttt{YYYY-MM-DD}. Результат
может выглядеть примерно так: \textchurchslavonic{\cuDate{2016-04-22}}.

Отметим, что значение даты никоем образом не интерпретируется и не нормализируется. Поэтому можно вызывать макрокоманду и с
невозможными датами, например 32 апреля --- такая дата будет отформатирована как 32 апреля. Так что команду \cs{cuDate} можно
использовать для набора фраз вроде <<дата \verb+\cuDate{2016-04-32}+ не существует ни в одном календаре>>.

Однако, если вы используете свой формат даты и в этом формате задействованы символические переменные \cs{cuDOW} (день недели)
или \cs{cuYEARAM} (год от сотворения мира), то значения этих переменных будут вычислены исходя из заданной даты --- и дата интерпретируется
как дата по григорианскому календарю (<<новому стилю>>). В этом случае, невозможные даты будут нормализованы методом экстраполяции. Например, 32 апреля
будет интерпретировано как 2 мая для целей определения дня недели и года от сотворения мира.

Если ваш формат использует день недели (\cs{cuDOW}) или год от сотворения мира (\cs{cuYEARAM}), и вы указываете дату по юлианскому календарю (<<старому стилю>>),
вы должны вместо \cs{cuDate} пользоваться макрокомандой \cs{cuDateJulian} для правильной обработки дня недели и года от сотворения мира.

Лучше всего всегда использовать \cs{cuDate} для форматирования дат по григорианскому календарю и всегда использовать \cs{cuDateJulian} для
форматирования дат по юлианскому календарю --- вне зависимости от значения текущего формата. Таким образом вы можете впоследствии изменить
формат даты (например, добавив в него день недели) и результат останется правильным.

\subsection{\cs{cuDateJulian}}
Форматирует дату в соответствии с текущим форматом подобно команде \cs{cuDate}. Отличие заключается в том, что аргумент
интерпретируется как дата по юлианскому, а не григорианскому календарю. Это имеет значение только если текущий формат даты
использует символические имена \cs{cuDOW} (день недели) или \cs{cuYEARAM} (год от сотворения мира).
\end{RU}

\begin{EN}
\subsection{\cs{cuDefineDateFormat}}
This command allows you to define your own date format.
It does not change how \cs{cuDate} formats its output (for that, use \cs{cuUseDateFormat}).
Example:
\end{EN}

\begin{RU}
\subsection{\cs{cuDefineDateFormat}}
Команда определяет формат даты. Она никак не влияет на то, как \cs{cuDate} форматирует свой вывод (для этого используется \cs{cuUseDateFormat}).
Пример:
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
\verb+\cuDefineDateFormat{long}{%+\\
\verb+  \cuDayName{\cuDOW},+\\
\verb+  \cuNum{\cuDAY}\textunderscore +гѡ\verb+~%+\\
\verb+  \cuMonthName{\cuMONTH},~%+\\
\verb+  +лѣ́та ѿ сотворе́нїѧ мі́ра\verb+~%+\\
\verb+  \cuNum{\cuYEARAM}%+\\
\verb+}+\\
\end{tabular}
\end{churchslavonic}
\end{center}
%
\begin{EN}
defines a format with name \texttt{long}. If we use this format to print the same date as before, we will get:
\textchurchslavonic{\cuUseDateFormat{long}\cuDate{2016-04-22}}.
\end{EN}
%
\begin{RU}
определяет новый формат с именем \texttt{long}. Если мы напечатаем дату этим форматом, то получим:
\textchurchslavonic{\cuUseDateFormat{long}\cuDate{2016-04-22}}.
\end{RU}

\begin{EN}
The following symbolic names can be used when formatting the date:
\begin{itemize}
\item \cs{cuYEAR} --- the year part of a date (a number, like \texttt{2016})
\item \cs{cuYEARAM}\footnotemark[1] --- the year Anno Mundi, that is, since the creation of the world accoding to the Byzantine reckoning (aka ``the Byzantine era''; a number, like \texttt{7525})
\item \cs{cuMONTH} --- the month part of a date (a number from 1 to 12, with January set to 1)
\item \cs{cuDAY} --- the day of the month
\item \cs{cuDOW}\footnotemark[1] --- the day of the week (number from 0 to 6, where 0 means ``Sunday'')
\footnotetext[1]{If your format uses this value, make sure that you format the date with the correct macro:
    you must use \cs{cuDate} for dates on the Gregorian calendar and
    \cs{cuDateJulian} for dates on the Julian calendar.}
\footnotetext[2]{See \url{https://en.wikipedia.org/wiki/Indiction}.}
\item \cs{cuINDICTION} --- the indiction\footnotemark[2] (a number from 1 to 15)
\end{itemize}

\end{EN}

\begin{RU}
При определении формата можно пользоваться следующими символическими именами:
\begin{itemize}
\item \cs{cuYEAR} --- год (число, например \texttt{2016})
\item \cs{cuYEARAM}\footnotemark[1] --- год от сотворения мира по византийскому летоисчеслению (число, например \texttt{7525}).
\item \cs{cuMONTH} --- месяц (число от 1 до 12, где 1 означает <<январь>>)
\item \cs{cuDAY} --- день месяца
\item \cs{cuDOW}\footnotemark[1] --- день недели (число от 0 to 6, где 0 означает <<воскресенье>>)
\item \cs{cuINDICTION} --- индикт\footnotemark[2] (число от 1 до 15)
\footnotetext[1]{Если ваш формат
    пользуется этим значением, вы должны форматировать дату правильной макрокомандой: \cs{cuDate}
    для дат по григорианскому календарю и \cs{cuDateJulian} для дат по юлианскому календарю.}
\footnotetext[2]{См.~\url{https://ru.wikipedia.org/wiki/\%D0\%98\%D0\%BD\%D0\%B4\%D0\%B8\%D0\%BA\%D1\%82}}
\end{itemize}
\end{RU}

\begin{EN}
\subsection{\cs{cuUseDateFormat}}
This command sets the date format to be used by the subsequent \cs{cuDate} and \cs{cuDateJulian}.

\subsection{\cs{cuMonthName}}
This command expands a numeric argument (month number) into textual representation. It is typically used when defining a date format.
For example, a date format named \texttt{default} is defined as:
\end{EN}

\begin{RU}
\subsection{\cs{cuUseDateFormat}}
Макрокоманда устанавливает имя текущего формата даты. Этот формат будет использоваться при последующих вызовах макрокоманд
\cs{cuDate} и \cs{cuDateJulian}.

\subsection{\cs{cuMonthName}}
Команда раскрывает числовой аргумент в текстовое представление месяца. Команда обычно используется при задании формата
даты. Например, формат с именем \texttt{default} определен так:
\end{RU}
%
\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
\verb+\cuDefineDateFormat{default}{%+\\
\verb+  \cuNum{\cuDAY}~\cuMonthName{\cuMONTH},%+\\
\verb+  ~+лѣ́та\verb+~\cuNum{\cuYEAR}%+\\
\verb+}%+\\
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}
\subsection{\cs{cuDayName}}
Expands a numeric argument into a textual representation of the day of the week in the nominative case.

\subsection{\cs{cuDayNameAccusative}}
Expands a numeric argument into a textual representation of the day of the week in the accusative case.

\subsection{\cs{cuToday}}
This macro expands to a triplet \texttt{YYYY-MM-DD}. The date is generated according to the Gregorian calendar.

\subsection{\cs{cuTodayJulian}}
This macro expands to a triplet \texttt{YYYY-MM-DD}. The date is generated according to the Julian calendar.

It is a shortcut for \verb+\cuAsJulian{\cuToday}+.

\subsection{\cs{cuAsJulian}}
Converts a date on the Gregorian calendar to a date on the Julian calendar. Input and output use numeric triplet format \texttt{YYYY-MM-DD}.

Useful when the same date needs to be formatted both according to the Gregorian and Julian calendars.

\subsection{\cs{cuAsGegorian}}
Converts a date according to the Julian calendar to a date according to the Gregorian calendar. Input and output use numeric triplet format \texttt{YYYY-MM-DD}.

\end{EN}

\begin{RU}
\subsection{\cs{cuDayName}}
Команда раскрывает числовой аргумент в текстовое представление дня недели в именительном падеже.

\subsection{\cs{cuDayNameAccusative}}
Команда раскрывает числовой аргумент в текстовое представление дня недели в винительном падеже.

\subsection{\cs{cuToday}}
Эта макрокоманда раскрывается в текущую дату в виде триплета \texttt{YYYY-MM-DD}. Дата выводится по григорианскиму календарю (<<новому стилю>>).

\subsection{\cs{cuTodayJulian}}
Эта макрокоманда раскрывается в текущую дату в виде триплета \texttt{YYYY-MM-DD}. Дата выводится по юлианскиму календарю (<<старому стилю>>).

Команда просто раскрывается в:  \verb+\cuAsJulian{\cuToday}+.

\subsection{\cs{cuAsJulian}}
Преобразует дату по григорианскому календарю в дату по юлианскому календарю.
Дата задается и выводится как числовой триплет \texttt{YYYY-MM-DD}.

Команда полезна, когда одну и ту же дату надо написать и по григорианскому, и по юлианскому календарю.

\subsection{\cs{cuAsGregorian}}
Преобразует дату по юлианскому календарю в дату по григорианскому календарю. Дата задается и выводится как числовой триплет \texttt{YYYY-MM-DD}.

\end{RU}

\begin{EN}
\section{Kinovar}
Printed and hand-written Church Slavonic texts often use color to highlight sectional
and paragraph structure and to indicate liturgical rubrics, section names, comments,
and marginal notes. The first letter of each paragraph is also often colored red.

\subsection{\cs{cuKinovar}}
Takes a single argument and prints it using red color.
For example, explicitly specifying its argument one gets the expected result:

\end{EN}

\begin{RU}
\section{Киноварь}
Печатные и рукописные книги на церковнославянском языке часто пользуются
красным цветом (<<киноварью>>) для выделения структурных элементов текста.
Обычно богослужебные указания (<<рубрики>>), заголовки, замечания и пометы
на полях печатаются красным цветом. Кроме того, первая буква каждого параграфа тоже
часто выделяется красным цветом.

\subsection{\cs{cuKinovar}}
Команда печатает свой аргумент красным цветом. Например, если мы явно зададим текст аргумента, то получим ожидаемый результат:
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}[]{ | l | l | }
\hline
\verb+\cuKinovar{+ли́къ:\verb+}+ гдⷭ҇и поми́лꙋй. & \cuKinovar{ли́къ:} гдⷭ҇и поми́лꙋй. \\
\hline
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}
If one uses the \TeX\ mechanism of implicit argument detection,
then the first character of the text after this command will be printed in red.
However, a non-trivial feature of this command is that it will also ``collect'' all
of the diacritical marks that belong to this first character,
and thus all accents will also be colored in red!
Use this command in the indirect parameter mode to print in red the first letter
of each paragraph.\footnote{You can also experiment
with the \TeX\ command \cs{everypar} to automate this, but the success or failure of this technique critically depends on the
\LaTeX\ class used and packages loaded. We found it very fragile and thus the \pkg{churchslavonic} package does not offer
any automation for this task. It may be easier and more robust to use the Find/Replace functionality embedded in any non-trivial text
editor to just automatically place a \cs{cuKinovar} command before every paragraph of the source text.}
\end{EN}

\begin{RU}
Если же используется механизм \TeX{} неявного задания аргумента, то команда будет применена к первой букве последующего текста.
При этом команда ``соберет'' все необходимые выносные символы, так что все надстрочные знаки первой буквы будут также корректно раскрашены!
Поэтому очень удобно использовать эту команду с неявным заданием аргумента для раскраски первой буквы параграфа.\footnote{Вы также
можете поэкспериментировать со встроенной командой \TeX\ \cs{everypar} с целью полностью автоматизировать раскраску первой буквы
каждого параграфа. Однако успех сильно зависит от того, какой класс системы \LaTeX\ используется и от того, какие пакеты подгружаются.
Мы не нашли надежного способа заставить \cs{everypar} работать, и поэтому пакет \pkg{churchslavonic} не предлагает никаких
макрокоманд для дальнейшей автоматизации этого процесса. На практике, часто проще и надежнее воспользоваться функцией
текстового редактора Найти/Заменить для вставки макрокоманды \cs{cuKinovar} перед каждым параграфом.}
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}[]{ | l | l | }
\hline
\verb+\cuKinovar+ Пои́мъ гдⷭ҇ви пѣ́снь но́вꙋю &
\cuKinovar Пои́мъ гдⷭ҇ви пѣ́снь но́вꙋю \\
\verb+\cuKinovar+ Ꙗ҆́кѡ тꙋ́ча на тро́скотъ & \cuKinovar Ꙗ҆́кѡ тꙋ́ча на тро́скотъ \\
\hline
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}

\subsection{\cs{cuKinovarColor}}
Switches the current color to red. One would typically use this command
inside a group that limits the scope of red text, unless
you want all subsequent text to be colored red.

\cuKinovar{Information:} The shade of red used by the \cs{cuKinovar} is declared in the package as a new color called \verb+kinovar+, and is set to (205, 8, 3) in the RGB color space, which has a hexadecimal representation of \verb+#CC0502+.
\end{EN}

\begin{RU}

\subsection{\cs{cuKinovarColor}}
Команда переключает текущий цвет на красный. Должна использоваться
внутри группы, которая ограничит ее действие (если вы не хотите
чтобы весь последующий текст был напечатан красным цветом).

\cuKinovar{Справка:} Оттенок красного цвета, используемый командой \cs{cuKinovar} объявляется в пакете новым цветом с названием \verb+kinovar+, и задан как (205, 8, 3) в RGB-цветовом пространстве, что равно \verb+#CC0502+ в шестнадцатиразрядном представлении.
\end{RU}

\begin{EN}
\section{Miscellaneous}
\subsection{\cs{cuMarginMark}, \cs{cuMarginMarkSkip}, \& \cs{cuMarginMarkText}}
The command \cs{cuMarginMark} is used to place short text in the margin
at the same level as the line where the macro is placed.
Example:
\end{EN}
%
\begin{RU}
\section{Разное}
\subsection{\cs{cuMarginMark}, \cs{cuMarginMarkSkip} и \cs{cuMarginMarkText}}
Команда \cs{cuMarginMark} используется для печати значков на полях,
напротив строки, где вызвана эта команда.
Например:
\end{RU}
%
\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
  \verb+\cuMarginMark{+в҃\verb+}\cuKinovar+ Бл҃гословѝ дꙋшѐ моѧ̀ гдⷭ҇а и҆ не забыва́й\\
  всѣ́хъ воздаѧ́нїй є҆гѡ̀. \verb+\cuMarginMark{+а҃\verb+}\cuKinovar+ Ѡ҆чища́ющаго \\
  всѧ̑ беззакѡ́нїѧ твоѧ̑, и҆сцѣлѧ́ющаго  всѧ̑ недꙋ́ги твоѧ̑: \\
  \verb+\cuMarginMark{+в҃\verb+}\cuKinovar+ И҆збавлѧ́ющаго ѿ и҆стлѣ́нїѧ  живо́тъ тво́й,\\
  вѣнча́ющаго тѧ̀ млⷭ҇тїю и҆ щедро́тами: \verb+\cuMarginMark{+а҃\verb+}\cuKinovar+\\
  И҆сполнѧ́ющаго во бл҃ги́хъ жела́нїе твоѐ, ѡ҆бнови́тсѧ  ꙗ҆́кѡ ѻ҆́рлѧ \\
  ю҆́ность твоѧ̀.
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{EN}
\noindent
Will result in:
\end{EN}
%
\begin{RU}
\noindent
Получим такой результат:
\end{RU}

\begin{center}
\begin{churchslavonic}
\let\hMn=\cuMarginMark
\let\hKv=\cuKinovar
\parbox{0.75\textwidth}{%
  \textwidth=0.75\textwidth
  \hMn{в҃}\hKv Бл҃гословѝ дꙋшѐ моѧ̀ гдⷭ҇а и҆ не забыва́й всѣ́хъ  воздаѧ́нїй є҆гѡ̀.
  \hMn{а҃}\hKv Ѡ҆чища́ющаго всѧ̑ беззакѡ́нїѧ твоѧ̑, и҆сцѣлѧ́ющаго  всѧ̑ недꙋ́ги твоѧ̑:
  \hMn{в҃}\hKv И҆збавлѧ́ющаго ѿ и҆стлѣ́нїѧ  живо́тъ тво́й, вѣнча́ющаго тѧ̀ млⷭ҇тїю и҆ щедро́тами:
  \hMn{а҃}\hKv И҆сполнѧ́ющаго во бл҃ги́хъ жела́нїе твоѐ, ѡ҆бнови́тсѧ  ꙗ҆́кѡ ѻ҆́рлѧ ю҆́ность твоѧ̀.
}
\end{churchslavonic}
\end{center}

\begin{EN}
The marginal mark is placed on the right margin for odd pages
and on the left margin for even pages (e.g.~the mark is placed on the
``outer'' margin, not the spine margin), which is usualy the desired behavior.

The distance between the mark and the text is controlled by the value
of \cs{cuMarginMarkSkip}. The default is:
\end{EN}
%
\begin{RU}
Помета помещается на <<внешнее>> поле, то есть справа от текста для нечетных страниц и слева от текста для четных.

Расстояние между пометой и текстом задается через значение \cs{cuMarginMarkSkip}. По умолчанию это:
\end{RU}
%
\begin{verbatim}
\def\cuMarginMarkSkip{0.6em}
\end{verbatim}

\begin{EN}
To globally customize the font and color of the margin mark use \cs{cuMarginMarkText}.
For example, to make margin marks appear in red color, redefine \cs{cuMarginMarkText} in the preamble of your
document like this:
\end{EN}
%
\begin{RU}
Шрифт и цвет пометы можно изменить, переопределив команду \cs{cuMarginMarkText}.
Например, если Вы хотите чтобы все пометы печатались красным цветом, то достаточно поместить
в преамбулу вашего документа следующее определение:
\end{RU}
\begin{verbatim}
\def\cuMarginMarkText#1{\cuKinovar{#1}}
\end{verbatim}

\begin{EN}
If you need to change the font/size/color just for a single mark, you can do it directly with \cs{cuMarginMark}:
\end{EN}

\begin{RU}
Если надо поменять размер, цвет, или шрифт для какой-то одной пометы, то проще всего это сделать при
вызове \cs{cuMarginMark}:
\end{RU}

\begin{verbatim}
\cuMarginMark{{\tiny *}}
\end{verbatim}

\begin{EN}
\subsection{Dropcaps}
The mechanism that the \cs{cuKinovar} macro is using to collect all accents
(when the argument is specified implicitly) can be useful for
many other purposes. One example is to typeset a dropletter at the beginning of a chapter
(this is often used in Church Slavonic texts). For this purpose, the standard \LaTeX\ package
\pkg{lettrine} works just fine. The only nuisance is that one has to be careful to
pass to \cs{lettrine} not just the first letter, but also any diacritical marks that
attach to this letter. Naturally, we want to reuse the
clever mechanism that \cs{cuKinovar} uses, and automatically collect the diacritical marks!

Here is an example of how to accomplish this:
\end{EN}

\begin{RU}
\subsection{Буквицы}
Механизм, используемый командой \cs{cuKinovar} для сбора выносных символов (при неявном задании аргумента), может оказаться полезен
в некоторых других случаях. Один из примеров --- это ``буквицы'' в начале разделов. Для набора буквицы отлично работает стандартный
пакет \pkg{lettrine}. Единственное неудобство --- это необходимость задавать явно первую букву вместе со всеми ее выносными символами.
Естественно желание упростить и автоматизировать эту работу задействовав тот же механизм, что и в \cs{cuKinovar}.

Вот как можно добиться этого:
\end{RU}

\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
\verb+\def\cu@lettrine{\lettrine[lines=3,findent=0pt,nindent=0pt]}+\\
\verb+\def\cuLettrine{\cu@tokenizeletter\cu@lettrine}+\\
\verb+\renewcommand{\LettrineFontHook}{\cuKinovarColor}+\\
\end{tabular}
\end{churchslavonic}
\end{center}
%
\begin{EN}
Once this definition of \verb+\cuLettrine+ is created (somewhere in the preamble, between the declarations \cs{makeatletter} and \cs{makeatother}),
you can create drop capitals like this:
\end{EN}
%
\begin{RU}
Поместите это определение команды \verb+\cuLettrine+ в преамбулу вашего документа (и не забудьте окружить его командами \cs{makeatletter} и \cs{makeatother}).
После этого можно набирать буквицы так:
\end{RU}
%
\begin{center}
\begin{churchslavonic}
\begin{tabular}{l}
\verb+\cuLettrine+ И҆́же дх҃а си́ла въ не́мощи соверша́етсѧ\ldots\\
\end{tabular}
\end{churchslavonic}
\end{center}

\begin{center}
\begin{churchslavonic}

\parbox{0.75\textwidth}{%
\textwidth=0.75\textwidth

\cuLettrine
И҆́же дх҃а си́ла въ не́мощи соверша́етсѧ, ꙗ҆́коже пи́сано є҆́сть, и҆ вѣ́рꙋемъ: въ не́мощи же не тѣлесѐ то́чїю, но ᲂу҆́бѡ и҆ сло́ва,
и҆ премꙋ́дрости на ѧ҆зы́цѣ лежа́ща. И҆ сѐ ꙗ҆́вѣ ѿ мно́гихъ ᲂу҆́бѡ и҆ны́хъ, па́че же ѿ и҆́же ѡ҆ вели́комъ бг҃осло́вѣ, и҆ бра́тѣ хрⷭ҇то́вѣ,
благода́тїю зри́мѣмъ.
}%
\end{churchslavonic}
\end{center}

\begin{EN}
\section{Znamenny Notation}
\subsection{Typesetting Znamenny Notation}
The package offers two commands for typesetting liturgical music in Znamenny Notation and other neumatic notation systems. To use these macro commands, you will need to declare the font that will be used to typeset the musical notation symbols and set the \cs{cuKrukFont} parameter, which is usually done in the preamble of the document. Example:
\end{EN}
%
\begin{RU}
\section{Знаменная нотация}
\subsection{Набор Знаменной нотации}
Пакет предлагает две макрокоманды для набора литургических песнопений в знаменной или других невменных музыкальных нотациях. Для начала следует декларировать шрифт, которым будут набираться символы нотации, и установить параметр \cs{cuKrukFont}; это обычно делается в преамбуле документа. Например:
\end{RU}

\label{znamenny}
\begin{verbatim}
\newfontfamily\musicFont[Scale=1.5]{MezenetsUnicode}
\let\cuKrukFont=\musicFont
\end{verbatim}

\begin{EN}
The command \cs{cuKruk} is used to typeset a syllable of text with a musical neume above it. It takes the neume as its first argument and the text as its second argument. This can be used to typeset Znamenny notation inline with text or to typeset relatively short passages, for example, the code:

\verb+Here is a Podchashie: \textchurchslavonic{\cuKruk{+{\musicFont }\verb+}{+\textchurchslavonic{Тво}\verb+}}+

will produce:

Here is a Podchashie: \textchurchslavonic{\cuKruk{}{Тво}}

The \cs{cuKrukPara} command is used to typeset longer, independent passages of music in Znamenny Notation. The command takes as an argument a line of neumes, followed by \verb+\\+, followed by a line of lyrics. Groups of neumes are separated by spaces and syllables are separated by the hyphen (\verb+-+) character. Here we use the command to typeset a piece in Znamenny Notation:
\end{EN}
%
\begin{RU}
Команда \cs{cuKruk} используется для набора одного слога с размещением над ним символов невменной нотации. Команда принимает два аргумента: в первом аргументе указываются невмы, во втором аргументе -- текст. Этот подход может быть использован для набора текста и знаменной нотации в строке или для набора достаточно кратких музыкальных отрывков. Например, набор команд:

Вот подчашие: \verb+\textchurchslavonic{\cuKruk{+{\musicFont }\verb+}{+\textchurchslavonic{Тво}\verb+}}+

\noindent дает такой результат:

Вот подчашие: \textchurchslavonic{\cuKruk{}{Тво}}

Команда \cs{cuKrukPara} используется для набора более длинных песнопений, нотированных Знаменной нотацией. В качестве аргумента команда принимает строку невм, затем разрыв \verb+\\+ и, затем, строку текста. Группы невм разделяются пробелами, а слоги разделяются символом дефиса (\verb+-+). Приведем пример того, как набрать песнопение в Знаменной нотации:
\end{RU}

\medskip

\verb+\cuKrukPara{+ {\musicFont                                                        } \verb+\\+ \textchurchslavonic{Хри-сто́съ ра-жда́-ет-сѧ, сла́-ви-те: Хри-сто́съ съ нб҃съ, срѧ́-щи-те: Хри-сто́съ на зе-млѝ, воз-но-си́-те-сѧ. по́й-те Го́-спо-де-ви всѧ̀-}\verb+~+ \textchurchslavonic{зе-млѧ̀, и҆ ве-се́-лї-емъ вос-по-\char"200C -йте лю́-дї-е, ꙗ҆́-кѡ про-сла́-ви-сѧ.}\verb+}+

\medskip

\begin{churchslavonic}
\noindent
\cuKrukPara{
                                                      
\\
Хри-сто́съ ра-жда́-ет-сѧ, сла́-ви-те: Хри-сто́съ съ нб҃съ, срѧ́-щи-те: Хри-сто́съ на зе-млѝ, воз-но-си́-те-сѧ. по́й-те Го́-спо-де-ви всѧ̀-~ зе-млѧ̀, и҆ ве-се́-лї-емъ вос-по́--йте лю́-дї-е, ꙗ҆́-кѡ про-сла́-ви-сѧ.
}
\end{churchslavonic}

\medskip

\begin{EN}
\cuKinovar{Note 1}: the number of neume groups needs to equal the number of syllables, otherwise the \cs{cuKrukPara} command will return a compile-time error, such as: \verb+! Too many kruk groups.+

\cuKinovar{Note 2}: In both the \cs{cuKruk} and \cs{cuKrukPara} commands, the \verb+~+ character can be used when a neume appears without any syllable below it. The command will draw an underline under the relevant neume. Leaving a syllable empty will produce the same result. An empty neume block or the \verb+~+ character can also be used to produce a syllable with no neume above it (in this case, the neume block is left blank). To produce a neume with empty space (and no underline) below it, use the \cs{space} command. The following examples demonstrate the functionality:
\end{EN}
%
\begin{RU}
\cuKinovar{Примечание 1}: количество групп невм должно равняться количеству слогов, в противном случае при компиляции макрокоманда выдаст ошибку, например: \verb+! Too many kruk groups.+

\cuKinovar{Примечание 2}: Как в макрокоманде \cs{cuKruk}, так и в макрокоманде \cs{cuKrukPara}, символ \verb+~+ может быть использован, если какая-то невма стоит самостоятельно, а не над слогом текста. В этом случае под невмой будет нарисована горизонтальная черта. Горизонтальная черта также будет нарисована, если указан пустой слог. Если символ \verb+~+ введен в блок для невмы (или блок для невмы оставлен пустым), команды производят слог без невмы над ним (в этом случае, место для невмы остается пустым). Чтобы расположить невму над пустым текстовым блоком (без горизонтальной черты), можно ввести макрокоманду \cs{space}. Следующие примеры иллюстрируют эти возможности:
\end{RU}

\begin{tabular}{ll}
\verb+\cuKruk{+ {\musicFont } \verb+}{}+ & \cuKruk{}{} \\
\verb+\cuKruk{+ {\musicFont } \verb+}{~}+ & \cuKruk{}{~} \\
\verb+\cuKruk{+ {\musicFont } \verb+}{\space}+ & \cuKruk{}{\space} \\
\verb+\cuKruk{~}{text}+ & \cuKruk{~}{text} \\
\end{tabular}

\begin{EN}
\cuKinovar{Limitations}: fonts for Znamenny Notation usually provide color information for certain glyphs (such as the cinnabar marks) via data in the COLR and CPAL tables. However, COLR / CPAL technology is still not supported by \XeTeX{} or \LuaTeX{}. As a workaround, you can colorize cinnabar marks manually using the \cs{cuKinovar} command:
\end{EN}
%
\begin{RU}
\cuKinovar{Ограничения}: шрифты для Знаменной нотации обычно предоставляют информацию о цветах некоторых глифов (например, киноварных помет) в таблицах COLR и CPAL. Однако технология COLR и CPAL пока не поддерживается в \XeTeX{} и \LuaTeX{}. В качестве решения проблемы раскраски глифов, Вы можете раскрасить киноварные пометы вручную используя команду \cs{cuKinovar}:
\end{RU}

\begin{tabular}{cc}
\verb+\cuKruk{+{\musicFont } \verb+\cuKinovar{+ {\musicFont } \verb+}}{+ \textchurchslavonic{жда} \verb+}+ &  \textchurchslavonic{\cuKruk{\cuKinovar{}}{жда}} \\
\end{tabular}

\smallskip

\begin{EN}
However, this approach breaks normal OpenType positioning rules for the marks in \XeTeX{} (though it does appear to work correctly in \LuaTeX{} using the \pkg{luacolor} package).

\cs{cuKruk} commands may be nested, which can be used to produce `explanatory marks' (\textrussian{<<подобные пометы>>}):

\end{EN}
%
\begin{RU}
Однако данный подход приведет к неправильному позиционированию раскрашенных глифов в \XeTeX{} (похоже, правильных результатов можно достичь используя \LuaTeX{} и пакет \pkg{luacolor}).

Макрокоманды \cs{cuKruk} могут вкладываться друг в друга, что позволяет набирать текст с <<подобными пометами>>:
\end{RU}

\begin{tabular}{lc}
\verb+\cuKruk{\cuKruk{\cuKinovar{\tiny + {\musicFont } \verb+}}+ &  \textchurchslavonic{\cuKruk{\cuKruk[krukRaise=0.5em]{\cuKinovar{\tiny  }}{\Large }}{ла}} \\
\verb+{\Large + {\musicFont } \verb+}}{+ \textchurchslavonic{ла} \verb+}+ & \\
\end{tabular}

\medskip

\begin{EN}
\subsection{Controlling the Appearance of Znamenny Notation}

A number of parameters may be used to control the positioning and appearance of Znamenny neumes:

\begin{center}
\begin{tabular}{lp{3.5in}}
\hline
\verb+krukFont+ & Specifies the font that is used to typeset the neumes \\
\verb+sylSpace+ & Specifies the amount of spacing around a syllable (default is \verb+0.2em+) \\
\verb+topMargin+ & Specifies the amount of space (margin) above the neumes (default is \verb+0.3em+) \\
\verb+krukRaise+ & Specifies the amount of space between the neumes and lyrics (default is \verb+1em+) \\
\verb+sylRuleHeight+ & Specifies the thickness of the rule used when no syllable appears below a neume (default is \verb+0.08em+) \\
\hline
\end{tabular}
\end{center}

\noindent The parameters are passed as options to the \cs{cuKruk} and \cs{cuKrukPara} commands, separated by commas. For example, we can modify the spacing of neumes in the above example:
\end{EN}
%
\begin{RU}
\subsection{Управление внешним видом знаменных текстов}

Значение некоторых параметров может быть изменено, чтобы повлиять на позиционирование и внешний вид текстов со Знаменной нотацией:

\begin{center}
\begin{tabular}{lp{3.5in}}
\hline
\verb+krukFont+ & Указывает шрифт, используемый для отображения невм \\
\verb+sylSpace+ & Контролирует количество пустого пространства вокруг слога (по умолчанию: \verb+0.2em+) \\
\verb+topMargin+ & Контролирует количество пустого пространства (поле) над невмами (по умолчанию: \verb+0.3em+) \\
\verb+krukRaise+ & Контролирует длину разрыва между текстом и невмами (по умолчанию: \verb+1em+) \\
\verb+sylRuleHeight+ & Указывает толщину горизонтальной черты, используемой, когда под невмой нет слога (по умолчанию: \verb+0.08em+) \\
\hline
\end{tabular}
\end{center}

\noindent Эти параметры могут быть заданы как опции к макрокомандам \cs{cuKruk} и \cs{cuKrukPara}, разделенные запятыми. К примеру, повлияем на разрывы и поля в приведенном выше примере:
\end{RU}

\noindent \verb+\cuKrukPara[krukRaise=1.5em,topMargin=0.6em,sylRuleHeight=0.02em]{+ {\musicFont   } \verb+... \\+ \textchurchslavonic{Хри-сто́съ}\verb+... }+

\medskip

\begin{churchslavonic}
\noindent
\cuKrukPara[krukRaise=1.5em,topMargin=0.6em,sylRuleHeight=0.02em]{
                                                      
\\
Хри-сто́съ ра-жда́-ет-сѧ, сла́-ви-те: Хри-сто́съ съ нб҃съ, срѧ́-щи-те: Хри-сто́съ на зе-млѝ, воз-но-си́-те-сѧ. по́й-те Го́-спо-де-ви всѧ̀-~ зе-млѧ̀, и҆ ве-се́-лї-емъ вос-по́--йте лю́-дї-е, ꙗ҆́-кѡ про-сла́-ви-сѧ.
}
\end{churchslavonic}

\begin{thebibliography}{9}

\bibitem{UN41}
  Aleksandr Andreev, Yuri Shardt, and Nikita Simmons.
  \emph{Church Slavonic Typography in Unicode},
  Uncode Technical Note~41. 2015.
  \url{http://www.unicode.org/notes/tn41/}

\end{thebibliography}

\end{document}
